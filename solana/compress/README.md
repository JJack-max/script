# Compress - 简单安全的文件压缩工具

## 简介

**Compress** 是一个极简的文件加密压缩工具。完全由 7-Zip 处理文件内容和名称，程序只负责加密和文件管理。

## 主要特性

✨ **极简逻辑** - 只有两个命令  
🔐 **完全加密** - 文件内容 + 名称都被加密  
🂮 **自动密钥** - 用户无需任何密码管理  
⚡ **UUID 隐蔽** - 文件名完全随机化

## 使用方法

### 压缩加密

```bash
./compress -c <file_or_folder>
```

生成两个文件：
- `{UUID}.7z` - 加密的压缩存档  
- `{UUID}.key` - 解密密钥

**示例：**
```bash
./compress -c myfile.txt
```

**输出：**
```
🔐 正在加密压缩: myfile.txt

✅ 压缩加密完成！

📦 存档文件: 8170c67a-7bb0-4db5-8daf-845881f91d4d.7z
🔑 密钥文件: 8170c67a-7bb0-4db5-8daf-845881f91d4d.key

📋 解压：./compress -x 8170c67a-7bb0-4db5-8daf-845881f91d4d.7z -k 8170c67a-7bb0-4db5-8daf-845881f91d4d.key
```

### 解压解密

```bash
./compress -x <archive.7z> -k <keyfile.key>
```

**示例：**
```bash
./compress -x 8170c67a-7bb0-4db5-8daf-845881f91d4d.7z -k 8170c67a-7bb0-4db5-8daf-845881f91d4d.key
```

**输出：**
```
🔓 正在解密解压: 8170c67a-7bb0-4db5-8daf-845881f91d4d.7z

✅ 解压解密完成！

📁 文件已解压到当前目录
```

## 设计理念

🎯 **极简** - 程序只做三件事：
1. 生成随机密码
2. 调用 7-Zip 加密压缩
3. 保存密钥

✅ **7-Zip 是核心** - 所有文件操作都交给 7-Zip：
- 文件名加密
- 内容压缩
- 数据加密
- 文件头加密

🔐 **完全隐蔽** - 外界看不到：
- 原始文件名（7z 加密处理）
- 文件结构（7z 处理）
- 压缩格式（只有 `.7z` 扩展名）
- 密码为随机 32 字符强密码

## 文件说明

| 文件 | 描述 |
|------|------|
| `.7z` | 7-Zip 加密存档（包含原始文件名和内容） |
| `.key` | 加密的密钥文件（单行文本格式） |

**Keyfile 格式（v2）：**
```
v2:base64(iv+encrypted_password)
```

- `v2` - 协议版本标记
- `iv` - 16 字节随机初始化向量
- `encrypted_password` - AES-256-CBC 加密后的存档密码
- 所有数据使用 Base64 编码为一行文本

## 安全性

✅ **双层加密**
- **存档加密** - 7-Zip AES-256-CBC 加密文件内容和名称
- **密钥加密** - 存档密码本身用 AES-256-CBC + 本地机器密钥加密

✅ **文件完全隐蔽**
- 所有内容被 7-Zip AES-256 加密
- 文件头也被加密（`-mhe=on`）
- 原始文件名保存在加密的 7z 内部
- 密码本身不在 `.key` 中以明文形式存在

✅ **密钥分离**  
- 密码从不显示给用户
- 密码自动用本地机器密钥加密后保存在 `.key` 文件
- 分别管理 `.7z` 和 `.key` 文件增加安全性

✅ **本地密钥加密**
- 存档密码被 AES-256-CBC 加密
- 加密密钥从用户 `$HOME` 目录自动推导（每个用户/机器独有）
- 即使获得 `.key` 文件，没有本地机器密钥也无法解密

✅ **强密码**
- 自动生成 32 字符随机密码
- 包含大小写+数字+特殊字符

## 工作流

```bash
# 1. 压缩机密文件
./compress -c confidential/

# 输出：
# 📦 8170c67a.7z
# 🔑 8170c67a.key

# 2. 管理文件
# - 将 .7z 上传到云端推荐用
# - 将 .key 保存到本地/U盘

# 3. 恢复文件
./compress -x 8170c67a.7z -k 8170c67a.key

# 原始内容已恢复！
```

## 常见问题

### Q: 原始文件名会泄露吗？
**A:** 不会。文件名被 7-Zip 加密，只有解密后才能看到。

### Q: 支持什么格式？
**A:** 所有 7-Zip 支持的格式（文件、文件夹、任意类型）。

### Q: 性能如何？
**A:** 使用 7-Zip 9 级压缩，根据文件大小 1-10 秒不等。

### Q: 如果丢失 .key 怎么办？
**A:** 无法恢复。请备份 `.key` 文件！

### Q: .key 文件被他人获得怎么办？
**A:** 相对安全。外人需要从你的 `$HOME` 目录推导出本地机器密钥才能解密，这在本地无法做到。

### Q: 支持多个用户吗？
**A:** 是的。每个用户有独立的本地机器密钥，别人无法用自己机器解密你的 `.key`。

### Q: 进度条？
**A:** 7-Zip 会直接显示进度。

## 命令参考

```
压缩：  compress -c <path>
解压：  compress -x <archive> -k <key>
帮助：  compress -h
版本：  compress -V
```

## 安装

### Linux (Debian/Ubuntu)
```bash
sudo dpkg -i compress_2.1.0_amd64.deb
compress -c myfile.txt
```

### 直接运行
```bash
./compress -c myfile.txt
```

## 许可证

MIT
