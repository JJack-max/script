## é—®é¢˜ #358

ä¸€å®¶å…¬å¸åœ¨ **Amazon EC2** å®ä¾‹ä¸Šè¿è¡Œå…¶åº”ç”¨ç¨‹åºï¼Œå¹¶å°†å…¶æ”¾åœ¨ **Application Load Balancer (ALB)** åé¢ã€‚  
**ALB æ˜¯ Amazon CloudFront åˆ†å‘çš„æºç«™ï¼ˆoriginï¼‰**ã€‚

ç°çŠ¶ï¼š
- å›¾åƒå­˜å‚¨åœ¨ **Amazon S3**
- **è¶…è¿‡ 10 äº¿å¼ å›¾ç‰‡**
- **æ¯ç§’å¤„ç†æ•°åƒå¼ å›¾åƒè¯·æ±‚**

éœ€æ±‚ï¼š
- **åŠ¨æ€æ ¹æ®å›¾åƒå¤§å°è°ƒæ•´**
- **æ ¹æ®å®¢æˆ·ç«¯ï¼ˆUser-Agentï¼‰è¿”å›åˆé€‚çš„å›¾åƒæ ¼å¼**
- **å°½é‡å‡å°‘è¿è¥å¼€é”€**

å“ªç§è§£å†³æ–¹æ¡ˆæœ€ç¬¦åˆè¦æ±‚ï¼Ÿ

A. åœ¨ EC2 å®ä¾‹ä¸Šå®‰è£…å¤–éƒ¨å›¾åƒç®¡ç†åº“å¹¶å¤„ç†å›¾åƒ  
B. åˆ›å»º CloudFront **æºè¯·æ±‚ç­–ç•¥**ï¼Œè‡ªåŠ¨è°ƒæ•´å›¾åƒå¤§å°å¹¶æ ¹æ® User-Agent æä¾›æ ¼å¼  
C. ä½¿ç”¨ **Lambda@Edge + å›¾åƒç®¡ç†åº“**ï¼Œå¹¶ä¸ CloudFront è¡Œä¸ºå…³è”  
D. åˆ›å»º CloudFront **å“åº”å¤´ç­–ç•¥**ï¼Œè‡ªåŠ¨è°ƒæ•´å›¾åƒå¤§å°å¹¶æ ¹æ® User-Agent æä¾›æ ¼å¼  

---

## æ­£ç¡®ç­”æ¡ˆ
**ğŸ‘‰ C**

---

## è§£æ

### å…³é”®è€ƒç‚¹
- **æµ·é‡å›¾ç‰‡ï¼ˆ10 äº¿çº§ï¼‰**
- **é«˜å¹¶å‘ï¼ˆæ¯ç§’æ•°åƒè¯·æ±‚ï¼‰**
- **åŠ¨æ€å›¾ç‰‡å¤„ç†ï¼ˆresize + formatï¼‰**
- **æœ€å°‘è¿ç»´æˆæœ¬**
- CloudFront å·²åœ¨æ¶æ„ä¸­

---

## ä¸ºä»€ä¹ˆé€‰ C

### âœ… Lambda@Edge æ˜¯ CloudFront ç«¯åŠ¨æ€å›¾ç‰‡å¤„ç†çš„æ ‡å‡†è§£æ³•

**Lambda@Edge å¯ä»¥åœ¨ CloudFront è¾¹ç¼˜èŠ‚ç‚¹æ‰§è¡Œä»£ç ï¼š**
- æ ¹æ®è¯·æ±‚å‚æ•°ï¼ˆwidth / height / qualityï¼‰
- æ ¹æ® `User-Agent`
- åŠ¨æ€ï¼š
  - è°ƒæ•´å›¾ç‰‡å¤§å°
  - è½¬æ¢æ ¼å¼ï¼ˆWebP / AVIF / JPEG / PNGï¼‰

ğŸ‘‰ **åœ¨ç”¨æˆ·æœ€è¿‘çš„è¾¹ç¼˜èŠ‚ç‚¹å®Œæˆå¤„ç†ï¼Œå»¶è¿Ÿæœ€ä½**

---

### 1ï¸âƒ£ å‡ ä¹é›¶è¿ç»´å¼€é”€
- æ— éœ€ç®¡ç†æœåŠ¡å™¨
- æ— éœ€æ‰©ç¼©å®¹
- è‡ªåŠ¨éš CloudFront æ‰©å±•

éå¸¸é€‚åˆï¼š
- æ¯ç§’æ•°åƒè¯·æ±‚
- å…¨çƒåˆ†å‘
- çªå‘æµé‡

---

### 2ï¸âƒ£ å®Œç¾æ”¯æŒâ€œæŒ‰å®¢æˆ·ç«¯è¿”å›åˆé€‚æ ¼å¼â€
- Lambda@Edge å¯ä»¥ï¼š
  - è¯»å– `User-Agent`
  - åˆ¤æ–­æµè§ˆå™¨èƒ½åŠ›
  - è¿”å› WebP / AVIF / JPEG ç­‰

---

### 3ï¸âƒ£ æ¯” EC2 æ–¹æ¡ˆæˆæœ¬å’Œå¤æ‚åº¦éƒ½ä½
- EC2 æ–¹æ¡ˆï¼š
  - è¦ç»´æŠ¤å›¾åƒåº“
  - è¦å¤„ç†æ‰©ç¼©å®¹
  - æˆæœ¬å’Œè¿ç»´éƒ½é«˜
- Lambda@Edgeï¼š
  - æŒ‰è¯·æ±‚ä»˜è´¹
  - åªåœ¨éœ€è¦æ—¶è¿è¡Œ

---

## å…¶ä»–é€‰é¡¹ä¸ºä»€ä¹ˆé”™

### âŒ A. EC2 ä¸Šå®‰è£…å›¾åƒç®¡ç†åº“
- è¿ç»´æˆæœ¬é«˜
- æ‰©å±•å¤æ‚
- ä¸é€‚åˆ **10 äº¿å›¾ç‰‡ + é«˜å¹¶å‘**
- âŒ æ˜æ˜¾ä¸ç¬¦åˆâ€œæœ€å°‘è¿è¥å¼€é”€â€

---

### âŒ B. CloudFront æºè¯·æ±‚ç­–ç•¥
- æºè¯·æ±‚ç­–ç•¥åªèƒ½ï¼š
  - è½¬å‘ Header / Query / Cookie
- âŒ **ä¸èƒ½æ‰§è¡Œå›¾åƒå¤„ç†é€»è¾‘**
- å¸¸è§æ¦‚å¿µæ··æ·†é™·é˜±

---

### âŒ D. CloudFront å“åº”å¤´ç­–ç•¥
- å“åº”å¤´ç­–ç•¥åªèƒ½ï¼š
  - æ·»åŠ  / ä¿®æ”¹ HTTP Header
- âŒ **æ— æ³•è°ƒæ•´å›¾åƒå¤§å°æˆ–æ ¼å¼**
- çº¯é…ç½®é¡¹ï¼Œä¸æ˜¯è®¡ç®—èƒ½åŠ›

---

## ä¸€å¥è¯è®°å¿†
> **CloudFront åŠ¨æ€å›¾ç‰‡å¤„ç† = Lambda@Edge**

### è€ƒè¯•ç§’æ€å…¬å¼
> **æµ·é‡å›¾ç‰‡ + åŠ¨æ€ resize + format + æœ€å°‘è¿ç»´ â†’ Lambda@Edge**
